<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Count by Time of Day</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; }
        #chartContainer { width: 100%; height: 100vh; position: relative; padding: 10px; box-sizing: border-box; }
        #chartTitle { text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        canvas { max-width: 100%; height: auto !important; }
    </style>
</head>
<body>
    <div id="chartContainer">
        <div id="chartTitle">Count by Time of Day</div>
        <canvas id="myChart"></canvas>
    </div>

    <script>
        const ctx = document.getElementById('myChart').getContext('2d');
        let chart;

        function createChart() {
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        'Midnight to Early Morning',
                        'Early Morning',
                        'Morning to Noon',
                        'Afternoon',
                        'Evening',
                        'Night to Midnight'
                    ],
                    datasets: [{
                        data: [329, 179, 153, 168, 111, 263],
                        backgroundColor: [
                            '#0a3c5e', '#185a7d', '#3887ab',
                            '#75b1c5', '#5291ab', '#0e4d6f'
                        ],
                        borderWidth: 1,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    layout: {
                        padding: 20
                    }
                },
                plugins: [{
                    afterDraw: function(chart) {
                        var ctx = chart.ctx;
                        ctx.save();
                        var chartArea = chart.chartArea;
                        var centerX = (chartArea.left + chartArea.right) / 2;
                        var centerY = (chartArea.top + chartArea.bottom) / 2;
                        var radius = Math.min(chartArea.right - chartArea.left, chartArea.bottom - chartArea.top) / 2;

                        const timeRanges = ['00:00-03:59', '04:00-07:59', '08:00-11:59', '12:00-15:59', '16:00-19:59', '20:00-23:59'];

                        chart.data.datasets.forEach(function(dataset, i) {
                            var meta = chart.getDatasetMeta(i);
                            if (!meta.hidden) {
                                meta.data.forEach(function(element, index) {
                                    var startAngle = element.startAngle;
                                    var endAngle = element.endAngle;
                                    var middleAngle = startAngle + (endAngle - startAngle) / 2;

                                    var posX = centerX + Math.cos(middleAngle) * (radius * 0.7);
                                    var posY = centerY + Math.sin(middleAngle) * (radius * 0.7);

                                    ctx.fillStyle = '#fff';
                                    ctx.textAlign = 'center';
                                    ctx.textBaseline = 'middle';
                                    
                                    const data = dataset.data[index];
                                    const total = dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((data / total) * 100);
                                    
                                    var fontSize = Math.min(radius / 12, 12);
                                    ctx.font = `bold ${fontSize}px Poppins`;
                                    
                                    let label = chart.data.labels[index];
                                    if (radius < 100) {
                                        label = label.split(' ')[0];
                                    }
                                    ctx.fillText(label, posX, posY - fontSize * 1.2);
                                    
                                    ctx.font = `${fontSize - 1}px Poppins`;
                                    ctx.fillText(timeRanges[index], posX, posY);
                                    ctx.fillText(`${data} (${percentage}%)`, posX, posY + fontSize * 1.2);
                                });
                            }
                        });
                        ctx.restore();
                    }
                }]
            });
        }

        function handleResize() {
            createChart();
            const container = document.getElementById('chartContainer');
            const canvas = document.getElementById('myChart');
            canvas.style.height = `${container.offsetHeight - 40}px`;
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // Initial call to set up the chart
    </script>
</body>
</html>
